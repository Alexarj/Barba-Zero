<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Sal√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    button {
      padding: 8px 12px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 5px;
    }
    .confirmar { background: #16a34a; color: #fff; }
    .recusar { background: #dc2626; color: #fff; }
    .finalizar { background: #2563eb; color: #fff; }
    .logout { background: #444; color: #fff; }

    .card {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 12px;
    }

    .status {
      font-weight: bold;
      margin-top: 5px;
    }
  </style>
</head>

<body>

  <h1>üè™ Painel do Sal√£o</h1>
  <button class="logout" onclick="logout()">Sair</button>

  <hr>

  <h2>üìÖ Agendamentos</h2>
  <div id="lista"></div>

<script>
/* ================= SUPABASE ================= */
const supabase = supabase.createClient(
  "https://ujarxofdtmcjulqutpfd.supabase.co",
  "sb_publishable_ZhOEQgwUX5A6kQDvm0kB1g_houcldK8"
);

/* ================= AUTENTICA√á√ÉO ================= */
async function verificarLogin() {
  const { data } = await supabase.auth.getUser();
  if (!data.user) {
    window.location.href = "index.html";
  }
}
verificarLogin();

/* ================= LOGOUT ================= */
async function logout() {
  await supabase.auth.signOut();
  window.location.href = "index.html";
}

/* ================= CARREGAR AGENDAMENTOS ================= */
async function carregarAgendamentos() {
  const { data: userData } = await supabase.auth.getUser();
  const salao_id = userData.user.id;

  const { data, error } = await supabase
    .from("agendamentos")
    .select("*")
    .eq("salao_id", salao_id)
    .order("data_hora", { ascending: true });

  if (error) {
    alert("Erro ao carregar agendamentos");
    return;
  }

  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  if (data.length === 0) {
    lista.innerHTML = "<p>Nenhum agendamento.</p>";
    return;
  }

  data.forEach(a => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <p><b>Cliente:</b> ${a.nome_cliente}</p>
      <p><b>WhatsApp:</b> ${a.whatsapp}</p>
      <p><b>Hor√°rio:</b> ${new Date(a.data_hora).toLocaleString()}</p>
      <p class="status">Status: ${a.status}</p>

      ${a.status === "pendente" ? `
        <button class="confirmar" onclick="confirmarPix('${a.id}')">Confirmar Pix</button>
        <button class="recusar" onclick="recusarPix('${a.id}')">Recusar Pix</button>
      ` : ""}

      ${a.status === "confirmado" ? `
        <button class="finalizar" onclick="finalizar('${a.id}')">Finalizar Atendimento</button>
      ` : ""}
    `;

    lista.appendChild(div);
  });
}

/* ================= A√á√ïES ================= */
async function confirmarPix(id) {
  await supabase.from("agendamentos")
    .update({ status: "confirmado" })
    .eq("id", id);
  carregarAgendamentos();
}

async function recusarPix(id) {
  await supabase.from("agendamentos")
    .update({ status: "recusado" })
    .eq("id", id);
  carregarAgendamentos();
}

async function finalizar(id) {
  await supabase.from("agendamentos")
    .update({ status: "finalizado" })
    .eq("id", id);
  carregarAgendamentos();
}

/* ================= INIT ================= */
carregarAgendamentos();
</script>

</body>
</html>
